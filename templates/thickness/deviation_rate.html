{% extends 'index.html' %}
{% load staticfiles %}

{% block right-content-container %}

    <div style="padding: 15px; margin-top: -40px" class="layui-anim">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
          <legend>偏差率柱状图</legend>
        </fieldset>
    <div id="container" style="min-width:400px;height:400px"></div>
    <div class="layui-input-inline" style="width: 150px;">
        <select style="margin-left: 20px;" name="version" xm-select="version">
            {% for i in version_obj %}
                <option value="{{ i.version }}">{{ i.version }}</option>
            {% endfor %}
        </select>
    </div>
    <button style="margin-left: 20px" lay-filter="submit" class="layui-btn" onclick="SelectVersion()">选择</button>

    <script type="text/javascript" src="/static/plugins/formselects/dist/formSelects-v4.min.js"></script>
    <script>
    var formSelects = layui.formSelects;

         Highcharts.setOptions({
            global: {
                useUTC: false
            }
        });

        $(function(){
            initChart();
            console.log({{ nid }})
         });

        function initChart() {
            chart = {
                chart: {
                    type: 'column'
                },
                title: {
                    text: '偏差率'
                },
                xAxis: {
                    categories: [
                        '0.0-0.1','0.1-0.2','0.2-0.3','0.3-0.4','0.4-0.5','0.5-0.6','0.6-0.7','0.7-0.8','0.8-0.9','0.9-1.0','>=1.0'
                    ],
                    title: {
                        text: '偏差量'
                    },
                    crosshair: true
                },
                tooltip: {
                    // head + 每个 point + footer 拼接成完整的 table
                    headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                    pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                    '<td style="padding:0"><b>{point.y} 个</b></td></tr>',
                    footerFormat: '</table>',
                    shared: true,
                    useHTML: true
                },
                plotOptions: {
                    column: {
                        borderWidth: 0
                    }
                },
                series: [
                {#    {#}
                {#    name: 'V-3.0',#}
                {#    data: [1, 3, 2, 1, 1, 0, 1, 1, 0, 0, 0]#}
                {# }, {#}
                {#    name: 'V-2.0',#}
                {#    data: [2, 2, 1, 0, 1, 2, 1, 1, 0, 0, 0]#}
                {# },{#}
                {#    name: 'V-1.0',#}
                {#    data: [1, 1, 3, 2, 1, 0, 1, 1, 0, 0, 0]#}
                {# }#}
                ]
            };
            $('#container').highcharts(chart);
        }

        //选择版本并显示已选版本的数据信息
        function SelectVersion() {
            var version = formSelects.value('version', 'valStr');
            console.log(version);
            $.ajax({
                url: '/thickness/deviation-rate-ajax/{{ nid }}/',
                type: 'POST',
                data: {'version': version},
                dataType: 'JSON',
                success: function (arg) {
                    if (arg.status){
                        chart.series = arg.data_list;
                        $('#container').highcharts(chart);
                    }

                }
             })
        }



    </script>
{% endblock %}










