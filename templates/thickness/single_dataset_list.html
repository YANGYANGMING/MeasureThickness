{% extends 'index.html' %}
{% load staticfiles %}

{% block right-content-container %}
    <div style="padding: 15px; margin-top: -40px" class="layui-anim">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
          <legend>数据集详细信息</legend>
        </fieldset>
        <a href="/thickness/deviation-rate/{{ nid }}"><button style="margin-left: 20px" lay-filter="submit" class="layui-btn">查看数据集偏差率</button></a>
        <div id="container" style="width: 1600px; margin-left: 15px">
        </div>
        <div style="padding: 15px;" class="layui-anim layui-anim-upbit">
            <fieldset class="layui-elem-field">
            <legend>数据集筛选条件列表</legend>
            <div class="layui-field-box">
                <table class="layui-table layui-form">
                    <thead>
                        <tr>
                            <th>时间</th>
                            <th>数据ID</th>
                            <th>版本号</th>
                            <th>跑算法得出厚度值(mm)</th>
                            <th>手测厚度值(mm)</th>
                            <th>波形图</th>
                        </tr>
                    </thead>

                    <tbody id="tb-list">
                    </tbody>
                </table>
            </div>
            </fieldset>
        </div>
    </div>

    <div id="pager-id"></div>
    <input type="text" style="display: none;" id="nid" value="{{ nid }}">
    <input type="text" style="display: none;" id="total-count" value="{{ count }}">

        <script>

        $(function () {
            loadData(); //加载数据
            getPage();  //获取分页信息
         });

        var curr_page = 1;
        var limit = 10;
        var total = $('#total-count').val();
        var nid = $('#nid').val();

        function loadData() {
            $.ajax({
                url: '/thickness/single-dataset-list/' + nid,
                type: "POST",
                data: {
                    'curr_page': curr_page,
                    'limit': limit,
                },
                dataType: "JSON",
                success:function (ret) {
                    var data_list = ret.data_list;
                    var html = '';
                    $.each(data_list, function (k, v) {
                        var time = v.time;
                        var data_id = v.data_id;
                        var run_alg_thickness = v.run_alg_thickness;
                        var true_thickness = v.true_thickness;
                        html += "<tr>";
                        html += "<td>" + time + "</td>";
                        html += "<td>" + data_id + "</td>";
                        html += "<td>" + '{{ selected_version }}' + "</td>";
                        html += "<td>" + run_alg_thickness + "</td>";
                        html += "<td>" + true_thickness + "</td>";
                        if(run_alg_thickness === ''){
                            html += "<td><a href=\"/thickness/data-2048-chart/" + data_id + "/-1.0\">数据波形</a></td>";
                        }else{
                            html += "<td><a href=\"/thickness/data-2048-chart/" + data_id + "/" + run_alg_thickness + "\">数据波形</a></td>";
                        }
                        html += "</tr>";
                    });
                    $("#tb-list").empty().append(html); //页面填充
                    }
                });
            }

            function getPage() {
                layui.use(['laypage'], function() {
                    var laypage = layui.laypage;
                    laypage.render({
                        elem: 'pager-id'
                        ,count: total
                        ,layout: ['count', 'prev', 'page', 'next', 'limit', 'limits', 'skip']
                        ,jump: function(obj, first){
                            curr_page = obj.curr; //当前页
                            limit = obj.limit;   //每页显示的条数
                            if(!first){
                                loadData()
                                }
                            }
                          });
                     });
                }


        </script>

{% endblock %}










